{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\03yuk\\\\Desktop\\\\private\\\\react\\\\shift-reserch3\\\\client\\\\src\\\\Wishlist.js\";\nimport React, { Component } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    marginTop: theme.spacing(3),\n    overflowX: 'auto'\n  },\n  table: {\n    minWidth: 650\n  }\n}));\n\nclass Wishlist extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      query: this.props.location.query,\n      accessable: false,\n      //アクセス判定\n      memberlist: [],\n      //登録メンバー\n      allshiftdata: [],\n      //全シフト情報\n      printlist: [],\n      //表示するリスト\n      deadlineearly: 10,\n      deallinelate: 24,\n      startdate: \"\",\n      printdays: [] //表示する期間\n\n    };\n    this.onClickchangeterm = this.onClickchangeterm.bind(this);\n    this.setprintDays = this.setprintDays.bind(this);\n    this.sortmembershift = this.sortmembershift.bind(this);\n  }\n\n  componentDidMount() {\n    //アクセス判定\n    if (this.props.location.query !== undefined) {\n      if (this.props.location.query.pass === \"administer\") {\n        this.setState({\n          accessable: true\n        });\n        this.setdefaultDays(); //全ユーザー取得\n\n        fetch('/testmemberlist') //fetch('/memberlist')\n        .then(res => res.json()).then(list => {\n          this.setState({\n            memberlist: list\n          }); //全シフト情報取得\n\n          fetch('/testallshiftdata') //fetch('/allshiftdata')\n          .then(res => res.json()).then(data => {\n            this.setState({\n              allshiftdata: data\n            });\n            this.sortmembershift(list, data, this.state.startdate);\n          });\n        });\n      }\n    }\n  }\n\n  render() {\n    const classes = useStyles;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 71\n      },\n      __self: this\n    }, this.state.accessable ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 73\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 74\n      },\n      __self: this\n    }, \"Wishlist\"), \"\\u30B7\\u30D5\\u30C8\\u5E0C\\u671B\\u4E00\\u89A7\", React.createElement(\"button\", {\n      value: \"pre\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76\n      },\n      __self: this\n    }, \"\\u25C1\"), React.createElement(\"button\", {\n      value: \"back\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, \"\\u25B7\"), React.createElement(Paper, {\n      className: classes.root,\n      style: {\n        overflowX: 'scroll'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }, React.createElement(Table, {\n      className: classes.table,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, React.createElement(TableHead, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, React.createElement(TableRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(TableCell, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, \"name\"), this.state.printdays.map(day => React.createElement(TableCell, {\n      key: day,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, day)))), React.createElement(TableBody, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, this.state.printlist.map(member => React.createElement(TableRow, {\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, React.createElement(TableCell, {\n      component: \"th\",\n      scope: \"row\",\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, member.name), member.shift.map(shift => React.createElement(TableCell, {\n      component: \"th\",\n      scope: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, shift)))))))) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    }, \"\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u307E\\u305B\\u3093\"));\n  } //初期\n\n\n  setdefaultDays() {\n    //表示する期間開始日を計算\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = date.getMonth();\n    const day = date.getDate();\n    let startdate = \"\";\n\n    if (day < this.state.deadlineearly) {\n      startdate = new Date(year, month, 1);\n    } else if (day < this.state.deallinelate) {\n      startdate = new Date(year, month, 16);\n    } else if (day >= this.state.deallinelate) {\n      if (month === 11) {\n        startdate = new Date(year + 1, month + 1, 1);\n      } else {\n        startdate = new Date(year, month + 1, 1);\n      }\n    } //date確認用\n    //startdate = new Date(2019, 7, 16);\n\n\n    this.setprintDays(startdate);\n  }\n\n  onClickchangeterm(e) {\n    const startdate = this.state.startdate;\n    let year = startdate.getFullYear();\n    let month = startdate.getMonth();\n    let day = startdate.getDate();\n    const str = e.target.value;\n\n    if (str === \"pre\") {\n      if (day === 16) {\n        day = 1;\n      } else if (day === 1) {\n        if (month === 0) {\n          year--;\n          month = 11;\n          day = 16;\n        } else {\n          month--;\n          day = 16;\n        }\n      }\n    } else if (str === \"back\") {\n      //\n      if (day === 1) {\n        day = 16;\n      } else if (day === 16) {\n        if (month === 11) {\n          year++;\n          month = 0;\n          day = 1;\n        } else {\n          month++;\n          day = 1;\n        }\n      }\n    }\n\n    const newstartdate = new Date(year, month, day);\n    this.setState({\n      startdate: newstartdate\n    });\n    this.setprintDays(newstartdate);\n    this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\n  } //表示期間計算\n\n\n  setprintDays(startdate) {\n    //表示する期間配列生成\n    const days = [];\n\n    if (startdate.getDate() === 1) {\n      for (let i = 0; i < 15; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    } else if (startdate.getDate() === 16) {\n      const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\n\n      for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    }\n\n    this.setState({\n      startdate: startdate,\n      printdays: days\n    });\n  } //表示用list作成\n\n\n  sortmembershift(members, shifts, startdate) {\n    const printdate = startdate;\n    let printfinaldate = \"\";\n    let shiftlist = [];\n\n    if (printdate.getDate() === 1) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15);\n      shiftlist = Array(15);\n    } else if (printdate.getDate() === 16) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 0);\n      shiftlist = Array(printfinaldate.getDate() - 15);\n    }\n\n    const membertoshift = [];\n\n    for (const member of members) {\n      const myshift = shiftlist.slice();\n      myshift.fill(\"/\");\n\n      for (const shift of shifts) {\n        if (shift.userid === member.userid) {\n          const sd = String(shift.date);\n          const shiftyear = parseInt(sd.slice(0, 4));\n          const shiftmonth = parseInt(sd.slice(4, 6));\n          const shiftday = parseInt(sd.slice(6));\n\n          if (shiftyear === printdate.getFullYear() && shiftmonth === printdate.getMonth() + 1 && shiftday >= printdate.getDate() && shiftday <= printfinaldate.getDate()) {\n            //表示する情報\n            myshift[shiftday - printdate.getDate()] = shift.detail;\n          }\n        }\n      }\n\n      membertoshift.push({\n        name: member.name,\n        shift: myshift\n      });\n      console.log(myshift);\n    }\n\n    this.setState({\n      printlist: membertoshift\n    });\n  }\n\n}\n\nexport default Wishlist;","map":{"version":3,"sources":["C:\\Users\\03yuk\\Desktop\\private\\react\\shift-reserch3\\client\\src\\Wishlist.js"],"names":["React","Component","makeStyles","Table","TableBody","TableCell","TableHead","TableRow","Paper","useStyles","theme","root","width","marginTop","spacing","overflowX","table","minWidth","Wishlist","constructor","props","state","query","location","accessable","memberlist","allshiftdata","printlist","deadlineearly","deallinelate","startdate","printdays","onClickchangeterm","bind","setprintDays","sortmembershift","componentDidMount","undefined","pass","setState","setdefaultDays","fetch","then","res","json","list","data","render","classes","map","day","member","name","shift","date","Date","year","getFullYear","month","getMonth","getDate","e","str","target","value","newstartdate","days","i","push","findate","members","shifts","printdate","printfinaldate","shiftlist","Array","membertoshift","myshift","slice","fill","userid","sd","String","shiftyear","parseInt","shiftmonth","shiftday","detail","console","log"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\n\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        width: '100%',\r\n        marginTop: theme.spacing(3),\r\n        overflowX: 'auto',\r\n    },\r\n    table: {\r\n        minWidth: 650,\r\n    },\r\n}));\r\n\r\nclass Wishlist extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            query: this.props.location.query,\r\n            accessable: false,//アクセス判定\r\n            memberlist: [],//登録メンバー\r\n            allshiftdata: [],//全シフト情報\r\n            printlist: [],//表示するリスト\r\n            deadlineearly: 10,\r\n            deallinelate: 24,\r\n            startdate: \"\",\r\n            printdays: []//表示する期間\r\n        }\r\n\r\n        this.onClickchangeterm = this.onClickchangeterm.bind(this);\r\n        this.setprintDays = this.setprintDays.bind(this);\r\n        this.sortmembershift = this.sortmembershift.bind(this);\r\n    }\r\n    componentDidMount() {\r\n        //アクセス判定\r\n        if (this.props.location.query !== undefined) {\r\n            if (this.props.location.query.pass === \"administer\") {\r\n                this.setState({\r\n                    accessable: true\r\n                })\r\n                this.setdefaultDays();\r\n                //全ユーザー取得\r\n                fetch('/testmemberlist')\r\n                    //fetch('/memberlist')\r\n                    .then(res => res.json())\r\n                    .then(list => {\r\n                        this.setState({ memberlist: list })\r\n                        //全シフト情報取得\r\n                        fetch('/testallshiftdata')\r\n                            //fetch('/allshiftdata')\r\n                            .then(res => res.json())\r\n                            .then(data => {\r\n                                this.setState({ allshiftdata: data });\r\n                                this.sortmembershift(list, data, this.state.startdate);\r\n                            })\r\n                    })\r\n\r\n            }\r\n        }\r\n    }\r\n    render() {\r\n        const classes = useStyles;\r\n        return (\r\n            <div>\r\n                {this.state.accessable ? (\r\n                    <div>\r\n                        <h1>Wishlist</h1>\r\n                        シフト希望一覧\r\n                        <button value=\"pre\" onClick={this.onClickchangeterm}>◁</button>\r\n                        <button value=\"back\" onClick={this.onClickchangeterm}>▷</button>\r\n                        <Paper className={classes.root}\r\n                            style={{\r\n                                overflowX: 'scroll'\r\n                            }}>\r\n                            <Table className={classes.table}\r\n                            >\r\n                                <TableHead>\r\n                                    <TableRow>\r\n                                        <TableCell>name</TableCell>\r\n                                        {this.state.printdays.map((day) =>\r\n                                            <TableCell key={day}>{day}</TableCell>\r\n                                        )}\r\n                                    </TableRow>\r\n                                </TableHead>\r\n                                <TableBody>\r\n                                    {this.state.printlist.map(member =>\r\n                                        <TableRow key={member.name}>\r\n                                            <TableCell component=\"th\" scope=\"row\" key={member.name}>{member.name}</TableCell>\r\n                                            {member.shift.map(shift =>\r\n                                                <TableCell component=\"th\" scope=\"row\">{shift}</TableCell>)}\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </Paper>\r\n                    </div>\r\n                ) : (\r\n                        <div>アクセスできません</div>\r\n                    )}\r\n            </div>\r\n\r\n        );\r\n    }\r\n    //初期\r\n    setdefaultDays() {\r\n        //表示する期間開始日を計算\r\n        const date = new Date();\r\n        const year = date.getFullYear();\r\n        const month = date.getMonth();\r\n        const day = date.getDate();\r\n        let startdate = \"\";\r\n        if (day < this.state.deadlineearly) {\r\n            startdate = new Date(year, month, 1);\r\n        } else if (day < this.state.deallinelate) {\r\n            startdate = new Date(year, month, 16);\r\n        } else if (day >= this.state.deallinelate) {\r\n            if (month === 11) {\r\n                startdate = new Date(year + 1, month + 1, 1);\r\n            } else {\r\n                startdate = new Date(year, month + 1, 1);\r\n            }\r\n        }\r\n        //date確認用\r\n        //startdate = new Date(2019, 7, 16);\r\n        this.setprintDays(startdate);\r\n    }\r\n    onClickchangeterm(e) {\r\n        const startdate = this.state.startdate;\r\n        let year = startdate.getFullYear();\r\n        let month = startdate.getMonth();\r\n        let day = startdate.getDate();\r\n        const str = e.target.value;\r\n\r\n        if (str === \"pre\") {\r\n            if (day === 16) {\r\n                day = 1;\r\n            } else if (day === 1) {\r\n                if (month === 0) {\r\n                    year--;\r\n                    month = 11;\r\n                    day = 16;\r\n                } else {\r\n                    month--;\r\n                    day = 16;\r\n                }\r\n            }\r\n        } else if (str === \"back\") {\r\n            //\r\n            if (day === 1) {\r\n                day = 16;\r\n            } else if (day === 16) {\r\n                if (month === 11) {\r\n                    year++;\r\n                    month = 0;\r\n                    day = 1;\r\n                } else {\r\n                    month++;\r\n                    day = 1;\r\n                }\r\n            }\r\n        }\r\n        const newstartdate = new Date(year, month, day);\r\n        this.setState({ startdate: newstartdate })\r\n        this.setprintDays(newstartdate);\r\n        this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\r\n    }\r\n    //表示期間計算\r\n    setprintDays(startdate) {\r\n        //表示する期間配列生成\r\n        const days = [];\r\n        if (startdate.getDate() === 1) {\r\n            for (let i = 0; i < 15; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        } else if (startdate.getDate() === 16) {\r\n            const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\r\n            for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        }\r\n        this.setState({\r\n            startdate: startdate,\r\n            printdays: days\r\n        });\r\n    }\r\n    //表示用list作成\r\n    sortmembershift(members, shifts, startdate) {\r\n        const printdate = startdate;\r\n        let printfinaldate = \"\";\r\n        let shiftlist = [];\r\n        if (printdate.getDate() === 1) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15)\r\n            shiftlist = Array(15);\r\n        } else if (printdate.getDate() === 16) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 0);\r\n            shiftlist = Array(printfinaldate.getDate() - 15);\r\n        }\r\n        const membertoshift = [];\r\n        for (const member of members) {\r\n            const myshift = shiftlist.slice();\r\n            myshift.fill(\"/\");\r\n            for (const shift of shifts) {\r\n                if (shift.userid === member.userid) {\r\n                    const sd = String(shift.date);\r\n                    const shiftyear = parseInt(sd.slice(0, 4));\r\n                    const shiftmonth = parseInt(sd.slice(4, 6));\r\n                    const shiftday = parseInt(sd.slice(6));\r\n                    if ((shiftyear === printdate.getFullYear()) &&\r\n                        (shiftmonth === (printdate.getMonth() + 1)) &&\r\n                        (shiftday >= printdate.getDate()) &&\r\n                        (shiftday <= printfinaldate.getDate())) {\r\n                        //表示する情報\r\n                        myshift[shiftday - printdate.getDate()] = shift.detail;\r\n                    }\r\n                }\r\n            }\r\n            membertoshift.push({\r\n                name: member.name,\r\n                shift: myshift\r\n            })\r\n            console.log(myshift)\r\n        }\r\n\r\n        this.setState({\r\n            printlist: membertoshift\r\n        });\r\n    }\r\n}\r\n\r\nexport default Wishlist;"]},"metadata":{},"sourceType":"module"}