{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\03yuk\\\\Desktop\\\\private\\\\react\\\\shift-reserch3\\\\client\\\\src\\\\Wishlist.js\";\nimport React, { Component } from 'react';\nimport { makeStyles } from '@material-ui/core/styles';\nimport Table from '@material-ui/core/Table';\nimport TableBody from '@material-ui/core/TableBody';\nimport TableCell from '@material-ui/core/TableCell';\nimport TableHead from '@material-ui/core/TableHead';\nimport TableRow from '@material-ui/core/TableRow';\nimport Paper from '@material-ui/core/Paper';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    marginTop: theme.spacing(3),\n    overflowX: 'auto'\n  },\n  table: {\n    minWidth: 650\n  }\n}));\n\nclass Wishlist extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      query: this.props.location.query,\n      accessable: false,\n      //アクセス判定\n      memberlist: [],\n      //登録メンバー\n      allshiftdata: [],\n      //全シフト情報\n      allcommentdata: [],\n      //全コメント情報\n      printlist: [],\n      //表示するリスト\n      printcommentlist: [],\n      //表示するコメントリスト\n      deadlineearly: 10,\n      deallinelate: 24,\n      startdate: \"\",\n      printdays: [] //表示する期間\n\n    };\n    this.onClickchangeterm = this.onClickchangeterm.bind(this);\n    this.setprintDays = this.setprintDays.bind(this);\n    this.sortmembershift = this.sortmembershift.bind(this);\n    this.sortmembercomment = this.sortmembercomment.bind(this);\n  }\n\n  componentDidMount() {\n    //アクセス判定\n    if (this.props.location.query !== undefined) {\n      if (this.props.location.query.pass === \"administer\") {\n        this.setState({\n          accessable: true\n        });\n        this.setdefaultDays(); //全ユーザー取得\n\n        fetch('/testmemberlist') //fetch('/memberlist')\n        .then(res => res.json()).then(list => {\n          this.setState({\n            memberlist: list\n          }); //全シフト情報取得\n          //fetch('/testallshiftdata')\n\n          fetch('/allshiftdata').then(res => res.json()).then(data => {\n            this.setState({\n              allshiftdata: data\n            });\n            this.sortmembershift(list, data, this.state.startdate);\n          }); //全コメント取得\n\n          fetch('/testallcommentdata') //fetch('/allcommentdata')\n          .then(res => res.json()).then(data => {\n            this.setState({\n              allcommentdata: data\n            });\n            this.sortmembercomment(list, data, this.state.startdate);\n            console.log(data);\n          });\n        });\n      }\n    }\n  }\n\n  render() {\n    const classes = useStyles;\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83\n      },\n      __self: this\n    }, this.state.accessable ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 86\n      },\n      __self: this\n    }, \"Wishlist\"), \"\\u30B7\\u30D5\\u30C8\\u5E0C\\u671B\\u4E00\\u89A7\", React.createElement(\"button\", {\n      className: \"bluebutton\",\n      value: \"pre\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, \"\\u25C1\"), React.createElement(\"button\", {\n      className: \"bluebutton\",\n      value: \"back\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, \"\\u25B7\"), React.createElement(Paper, {\n      className: classes.root,\n      style: {\n        overflowX: 'scroll'\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, React.createElement(Table, {\n      className: classes.table,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 94\n      },\n      __self: this\n    }, React.createElement(TableHead, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96\n      },\n      __self: this\n    }, React.createElement(TableRow, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97\n      },\n      __self: this\n    }, React.createElement(TableCell, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98\n      },\n      __self: this\n    }, \"name\"), this.state.printdays.map(day => React.createElement(TableCell, {\n      key: day,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 100\n      },\n      __self: this\n    }, day)))), React.createElement(TableBody, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, this.state.printlist.map(member => React.createElement(TableRow, {\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }, React.createElement(TableCell, {\n      component: \"th\",\n      scope: \"row\",\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 107\n      },\n      __self: this\n    }, member.name), member.shift.map(shift => React.createElement(TableCell, {\n      component: \"th\",\n      scope: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 109\n      },\n      __self: this\n    }, shift))))))), \"\\u88DC\\u8DB3\\u5E0C\\u671B\", React.createElement(\"table\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, \"userid\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119\n      },\n      __self: this\n    }, \"wishday\"), React.createElement(\"th\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 120\n      },\n      __self: this\n    }, \"comment\")), this.state.printcommentlist.map(comment => React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, comment.name), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, comment.wishday), React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, comment.comment))))) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, \"\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u307E\\u305B\\u3093\"));\n  } //初期\n\n\n  setdefaultDays() {\n    //表示する期間開始日を計算\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = date.getMonth();\n    const day = date.getDate();\n    let startdate = \"\";\n\n    if (day < this.state.deadlineearly) {\n      startdate = new Date(year, month, 1);\n    } else if (day < this.state.deallinelate) {\n      startdate = new Date(year, month, 16);\n    } else if (day >= this.state.deallinelate) {\n      if (month === 11) {\n        startdate = new Date(year + 1, month + 1, 1);\n      } else {\n        startdate = new Date(year, month + 1, 1);\n      }\n    } //date確認用\n    //startdate = new Date(2019, 7, 16);\n\n\n    this.setprintDays(startdate);\n  }\n\n  onClickchangeterm(e) {\n    const startdate = this.state.startdate;\n    let year = startdate.getFullYear();\n    let month = startdate.getMonth();\n    let day = startdate.getDate();\n    const str = e.target.value;\n\n    if (str === \"pre\") {\n      if (day === 16) {\n        day = 1;\n      } else if (day === 1) {\n        if (month === 0) {\n          year--;\n          month = 11;\n          day = 16;\n        } else {\n          month--;\n          day = 16;\n        }\n      }\n    } else if (str === \"back\") {\n      //\n      if (day === 1) {\n        day = 16;\n      } else if (day === 16) {\n        if (month === 11) {\n          year++;\n          month = 0;\n          day = 1;\n        } else {\n          month++;\n          day = 1;\n        }\n      }\n    }\n\n    const newstartdate = new Date(year, month, day);\n    this.setState({\n      startdate: newstartdate\n    });\n    this.setprintDays(newstartdate);\n    this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\n    this.sortmembercomment(this.state.memberlist, this.state.allcommentdata, newstartdate);\n  } //表示期間計算\n\n\n  setprintDays(startdate) {\n    //表示する期間配列生成\n    const days = [];\n\n    if (startdate.getDate() === 1) {\n      for (let i = 0; i < 15; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    } else if (startdate.getDate() === 16) {\n      const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\n\n      for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    }\n\n    this.setState({\n      startdate: startdate,\n      printdays: days\n    });\n  } //表示用list作成（シフト\n\n\n  sortmembershift(members, shifts, startdate) {\n    const printdate = startdate;\n    let printfinaldate = \"\";\n    let shiftlist = [];\n\n    if (printdate.getDate() === 1) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15);\n      shiftlist = Array(15);\n    } else if (printdate.getDate() === 16) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth() + 1, 0);\n      shiftlist = Array(printfinaldate.getDate() - 15);\n    }\n\n    const membertoshift = [];\n\n    for (const member of members) {\n      const myshift = shiftlist.slice();\n      myshift.fill(\"/\");\n\n      for (const shift of shifts) {\n        if (shift.userid === member.userid) {\n          const sd = String(shift.date);\n          const shiftyear = parseInt(sd.slice(0, 4));\n          const shiftmonth = parseInt(sd.slice(4, 6));\n          const shiftday = parseInt(sd.slice(6));\n\n          if (shiftyear === printdate.getFullYear() && shiftmonth === printdate.getMonth() + 1 && shiftday >= printdate.getDate() && shiftday <= printfinaldate.getDate()) {\n            //表示する情報\n            myshift[shiftday - printdate.getDate()] = shift.detail;\n          }\n        }\n      }\n\n      membertoshift.push({\n        name: member.name,\n        shift: myshift\n      });\n    }\n\n    this.setState({\n      printlist: membertoshift\n    });\n  } //表示用list作成（コメント\n\n\n  sortmembercomment(members, comments, startdate) {\n    const printdate = startdate;\n    const membertocomment = [];\n\n    for (const member of members) {\n      let isAdd = false;\n\n      for (const com of comments) {\n        if (member.userid === com.userid) {\n          const commentdate = new Date(com.date);\n\n          if (printdate.getFullYear() + \"/\" + printdate.getMonth() + \"/\" + printdate.getDate() === commentdate.getFullYear() + \"/\" + commentdate.getMonth() + \"/\" + commentdate.getDate()) {\n            membertocomment.push({\n              name: member.name,\n              wishday: com.wishday,\n              comment: com.text\n            });\n            isAdd = true;\n            break;\n          }\n        }\n      }\n\n      if (!isAdd) {\n        membertocomment.push({\n          name: member.name,\n          wishday: \"\",\n          comment: \"\"\n        });\n        isAdd = false;\n      }\n    }\n\n    this.setState({\n      printcommentlist: membertocomment\n    });\n  }\n\n}\n\nexport default Wishlist;","map":{"version":3,"sources":["C:\\Users\\03yuk\\Desktop\\private\\react\\shift-reserch3\\client\\src\\Wishlist.js"],"names":["React","Component","makeStyles","Table","TableBody","TableCell","TableHead","TableRow","Paper","useStyles","theme","root","width","marginTop","spacing","overflowX","table","minWidth","Wishlist","constructor","props","state","query","location","accessable","memberlist","allshiftdata","allcommentdata","printlist","printcommentlist","deadlineearly","deallinelate","startdate","printdays","onClickchangeterm","bind","setprintDays","sortmembershift","sortmembercomment","componentDidMount","undefined","pass","setState","setdefaultDays","fetch","then","res","json","list","data","console","log","render","classes","map","day","member","name","shift","comment","wishday","date","Date","year","getFullYear","month","getMonth","getDate","e","str","target","value","newstartdate","days","i","push","findate","members","shifts","printdate","printfinaldate","shiftlist","Array","membertoshift","myshift","slice","fill","userid","sd","String","shiftyear","parseInt","shiftmonth","shiftday","detail","comments","membertocomment","isAdd","com","commentdate","text"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\n\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        width: '100%',\r\n        marginTop: theme.spacing(3),\r\n        overflowX: 'auto',\r\n    },\r\n    table: {\r\n        minWidth: 650,\r\n    },\r\n}));\r\n\r\nclass Wishlist extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            query: this.props.location.query,\r\n            accessable: false,//アクセス判定\r\n            memberlist: [],//登録メンバー\r\n            allshiftdata: [],//全シフト情報\r\n            allcommentdata: [],//全コメント情報\r\n            printlist: [],//表示するリスト\r\n            printcommentlist: [],//表示するコメントリスト\r\n            deadlineearly: 10,\r\n            deallinelate: 24,\r\n            startdate: \"\",\r\n            printdays: []//表示する期間\r\n        }\r\n\r\n        this.onClickchangeterm = this.onClickchangeterm.bind(this);\r\n        this.setprintDays = this.setprintDays.bind(this);\r\n        this.sortmembershift = this.sortmembershift.bind(this);\r\n        this.sortmembercomment = this.sortmembercomment.bind(this);\r\n    }\r\n    componentDidMount() {\r\n        //アクセス判定\r\n        if (this.props.location.query !== undefined) {\r\n            if (this.props.location.query.pass === \"administer\") {\r\n                this.setState({\r\n                    accessable: true\r\n                })\r\n                this.setdefaultDays();\r\n                //全ユーザー取得\r\n                fetch('/testmemberlist')\r\n                    //fetch('/memberlist')\r\n                    .then(res => res.json())\r\n                    .then(list => {\r\n                        this.setState({ memberlist: list })\r\n                        //全シフト情報取得\r\n                        //fetch('/testallshiftdata')\r\n                        fetch('/allshiftdata')\r\n                            .then(res => res.json())\r\n                            .then(data => {\r\n                                this.setState({ allshiftdata: data });\r\n                                this.sortmembershift(list, data, this.state.startdate);\r\n                            })\r\n                        //全コメント取得\r\n                        fetch('/testallcommentdata')\r\n                            //fetch('/allcommentdata')\r\n                            .then(res => res.json())\r\n                            .then(data => {\r\n                                this.setState({ allcommentdata: data });\r\n                                this.sortmembercomment(list, data, this.state.startdate);\r\n                                console.log(data);\r\n                            })\r\n                    })\r\n\r\n            }\r\n        }\r\n    }\r\n    render() {\r\n        const classes = useStyles;\r\n        return (\r\n            <div>\r\n                {this.state.accessable ? (\r\n                    <div>\r\n                        <h1>Wishlist</h1>\r\n                        シフト希望一覧\r\n                        <button className=\"bluebutton\" value=\"pre\" onClick={this.onClickchangeterm}>◁</button>\r\n                        <button className=\"bluebutton\" value=\"back\" onClick={this.onClickchangeterm}>▷</button>\r\n                        <Paper className={classes.root}\r\n                            style={{\r\n                                overflowX: 'scroll'\r\n                            }}>\r\n                            <Table className={classes.table}\r\n                            >\r\n                                <TableHead>\r\n                                    <TableRow>\r\n                                        <TableCell>name</TableCell>\r\n                                        {this.state.printdays.map((day) =>\r\n                                            <TableCell key={day}>{day}</TableCell>\r\n                                        )}\r\n                                    </TableRow>\r\n                                </TableHead>\r\n                                <TableBody>\r\n                                    {this.state.printlist.map(member =>\r\n                                        <TableRow key={member.name}>\r\n                                            <TableCell component=\"th\" scope=\"row\" key={member.name}>{member.name}</TableCell>\r\n                                            {member.shift.map(shift =>\r\n                                                <TableCell component=\"th\" scope=\"row\">{shift}</TableCell>)}\r\n                                        </TableRow>\r\n                                    )}\r\n                                </TableBody>\r\n                            </Table>\r\n                        </Paper>\r\n                        補足希望\r\n                        <table>\r\n                            <tr>\r\n                                <th>userid</th>\r\n                                <th>wishday</th>\r\n                                <th>comment</th>\r\n                            </tr>\r\n                            {this.state.printcommentlist.map(comment =>\r\n                                <tr>\r\n                                    <td>{comment.name}</td>\r\n                                    <td>{comment.wishday}</td>\r\n                                    <td>{comment.comment}</td>\r\n                                </tr>)}\r\n                        </table>\r\n                    </div>\r\n                ) : (\r\n                        <div>アクセスできません</div>\r\n                    )}\r\n            </div>\r\n\r\n        );\r\n    }\r\n    //初期\r\n    setdefaultDays() {\r\n        //表示する期間開始日を計算\r\n        const date = new Date();\r\n        const year = date.getFullYear();\r\n        const month = date.getMonth();\r\n        const day = date.getDate();\r\n        let startdate = \"\";\r\n        if (day < this.state.deadlineearly) {\r\n            startdate = new Date(year, month, 1);\r\n        } else if (day < this.state.deallinelate) {\r\n            startdate = new Date(year, month, 16);\r\n        } else if (day >= this.state.deallinelate) {\r\n            if (month === 11) {\r\n                startdate = new Date(year + 1, month + 1, 1);\r\n            } else {\r\n                startdate = new Date(year, month + 1, 1);\r\n            }\r\n        }\r\n        //date確認用\r\n        //startdate = new Date(2019, 7, 16);\r\n        this.setprintDays(startdate);\r\n    }\r\n    onClickchangeterm(e) {\r\n        const startdate = this.state.startdate;\r\n        let year = startdate.getFullYear();\r\n        let month = startdate.getMonth();\r\n        let day = startdate.getDate();\r\n        const str = e.target.value;\r\n\r\n        if (str === \"pre\") {\r\n            if (day === 16) {\r\n                day = 1;\r\n            } else if (day === 1) {\r\n                if (month === 0) {\r\n                    year--;\r\n                    month = 11;\r\n                    day = 16;\r\n                } else {\r\n                    month--;\r\n                    day = 16;\r\n                }\r\n            }\r\n        } else if (str === \"back\") {\r\n            //\r\n            if (day === 1) {\r\n                day = 16;\r\n            } else if (day === 16) {\r\n                if (month === 11) {\r\n                    year++;\r\n                    month = 0;\r\n                    day = 1;\r\n                } else {\r\n                    month++;\r\n                    day = 1;\r\n                }\r\n            }\r\n        }\r\n        const newstartdate = new Date(year, month, day);\r\n        this.setState({ startdate: newstartdate })\r\n        this.setprintDays(newstartdate);\r\n        this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\r\n        this.sortmembercomment(this.state.memberlist, this.state.allcommentdata, newstartdate);\r\n    }\r\n    //表示期間計算\r\n    setprintDays(startdate) {\r\n        //表示する期間配列生成\r\n        const days = [];\r\n        if (startdate.getDate() === 1) {\r\n            for (let i = 0; i < 15; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        } else if (startdate.getDate() === 16) {\r\n            const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\r\n            for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        }\r\n        this.setState({\r\n            startdate: startdate,\r\n            printdays: days\r\n        });\r\n    }\r\n    //表示用list作成（シフト\r\n    sortmembershift(members, shifts, startdate) {\r\n        const printdate = startdate;\r\n        let printfinaldate = \"\";\r\n        let shiftlist = [];\r\n        if (printdate.getDate() === 1) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15)\r\n            shiftlist = Array(15);\r\n        } else if (printdate.getDate() === 16) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth() + 1, 0);\r\n            shiftlist = Array(printfinaldate.getDate() - 15);\r\n        }\r\n        const membertoshift = [];\r\n        for (const member of members) {\r\n            const myshift = shiftlist.slice();\r\n            myshift.fill(\"/\");\r\n            for (const shift of shifts) {\r\n                if (shift.userid === member.userid) {\r\n                    const sd = String(shift.date);\r\n                    const shiftyear = parseInt(sd.slice(0, 4));\r\n                    const shiftmonth = parseInt(sd.slice(4, 6));\r\n                    const shiftday = parseInt(sd.slice(6));\r\n                    if ((shiftyear === printdate.getFullYear()) &&\r\n                        (shiftmonth === (printdate.getMonth() + 1)) &&\r\n                        (shiftday >= printdate.getDate()) &&\r\n                        (shiftday <= printfinaldate.getDate())) {\r\n                        //表示する情報\r\n                        myshift[shiftday - printdate.getDate()] = shift.detail;\r\n                    }\r\n                }\r\n            }\r\n            membertoshift.push({\r\n                name: member.name,\r\n                shift: myshift\r\n            })\r\n        }\r\n\r\n        this.setState({\r\n            printlist: membertoshift\r\n        });\r\n    }\r\n    //表示用list作成（コメント\r\n    sortmembercomment(members, comments, startdate) {\r\n        const printdate = startdate;\r\n        const membertocomment = [];\r\n        for (const member of members) {\r\n            let isAdd = false;\r\n            for (const com of comments) {\r\n                if (member.userid === com.userid) {\r\n                    const commentdate = new Date(com.date);\r\n                    if ((printdate.getFullYear() + \"/\" + printdate.getMonth() + \"/\" + printdate.getDate()) ===\r\n                        commentdate.getFullYear() + \"/\" + commentdate.getMonth() + \"/\" + commentdate.getDate()) {\r\n                        membertocomment.push({\r\n                            name: member.name,\r\n                            wishday: com.wishday,\r\n                            comment: com.text\r\n                        })\r\n                        isAdd = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (!isAdd) {\r\n                membertocomment.push({\r\n                    name: member.name,\r\n                    wishday: \"\",\r\n                    comment: \"\"\r\n                })\r\n                isAdd = false;\r\n            }\r\n        }\r\n        this.setState({\r\n            printcommentlist: membertocomment\r\n        });\r\n    }\r\n}\r\n\r\nexport default Wishlist;"]},"metadata":{},"sourceType":"module"}