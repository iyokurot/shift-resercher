{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\03yuk\\\\Desktop\\\\private\\\\react\\\\shift-reserch3\\\\client\\\\src\\\\Wishlist.js\";\nimport React, { Component } from 'react';\n\nclass Wishlist extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      //query: this.props.location.query,\n      nowloading: true,\n      //読み込み中\n      accessable: false,\n      //アクセス判定\n      memberlist: [],\n      //登録メンバー\n      allshiftdata: [],\n      //全シフト情報\n      allcommentdata: [],\n      //全コメント情報\n      printlist: [],\n      //表示するリスト\n      printcommentlist: [],\n      //表示するコメントリスト\n      deadlineearly: 10,\n      //締め切り日１\n      deallinelate: 24,\n      //締め切り日２\n      startdate: \"\",\n      printdays: [] //表示する期間\n\n    };\n    this.onClickchangeterm = this.onClickchangeterm.bind(this);\n    this.setprintDays = this.setprintDays.bind(this);\n    this.sortmembershift = this.sortmembershift.bind(this);\n    this.sortmembercomment = this.sortmembercomment.bind(this);\n  }\n\n  componentDidMount() {\n    //アクセス判定\n    //if (this.props.location.query !== undefined) {\n    //if (this.props.location.query.pass === \"administer\") {\n    //ユーザーデータ取得\n    //fetch('/testuserdata')\n    fetch('/userdata').then(res => res.json()).then(data => {\n      if (data.administer) {\n        //アクセス許可\n        this.setState({\n          accessable: true\n        });\n        this.setdefaultDays(); //全ユーザー取得\n        //fetch('/testmemberlist')\n\n        fetch('/memberlist').then(res => res.json()).then(list => {\n          this.setState({\n            memberlist: list\n          }); //全シフト情報取得\n          //fetch('/testallshiftdata')\n\n          fetch('/allshiftdata').then(res => res.json()).then(data => {\n            this.setState({\n              allshiftdata: data\n            });\n            this.sortmembershift(list, data, this.state.startdate);\n          }); //全コメント取得\n          //fetch('/testallcommentdata')\n\n          fetch('/allcommentdata').then(res => res.json()).then(data => {\n            this.setState({\n              allcommentdata: data,\n              nowloading: false\n            });\n            this.sortmembercomment(list, data, this.state.startdate);\n          });\n        });\n      } else {\n        this.setState({\n          nowloading: false\n        });\n      }\n    }); //}\n    //}\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 79\n      },\n      __self: this\n    }, this.state.nowloading ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 80\n      },\n      __self: this\n    }, \"\\u8AAD\\u307F\\u8FBC\\u307F\\u4E2D\") : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82\n      },\n      __self: this\n    }, this.state.accessable ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 84\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85\n      },\n      __self: this\n    }, \"Wishlist\"), \"\\u30B7\\u30D5\\u30C8\\u5E0C\\u671B\\u4E00\\u89A7\", React.createElement(\"button\", {\n      className: \"bluebutton\",\n      value: \"pre\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87\n      },\n      __self: this\n    }, \"\\u25C1\"), React.createElement(\"button\", {\n      className: \"bluebutton\",\n      value: \"back\",\n      onClick: this.onClickchangeterm,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88\n      },\n      __self: this\n    }, \"\\u25B7\"), React.createElement(\"div\", {\n      className: \"shittablediv\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 89\n      },\n      __self: this\n    }, React.createElement(\"table\", {\n      className: \"shifttable\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 90\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 91\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 92\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      className: \"blank\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93\n      },\n      __self: this\n    }, \"\\u540D\\u524D\"), this.state.printdays.map(day => React.createElement(\"th\", {\n      key: day,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 95\n      },\n      __self: this\n    }, day)))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99\n      },\n      __self: this\n    }, this.state.printlist.map(member => React.createElement(\"tr\", {\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      key: member.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }, member.name), member.shift.map(shift => React.createElement(\"td\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104\n      },\n      __self: this\n    }, shift))))))), React.createElement(\"div\", {\n      className: \"wishtablediv\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 110\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, \"\\u88DC\\u8DB3\\u5E0C\\u671B\"), React.createElement(\"table\", {\n      className: \"wishtable\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113\n      },\n      __self: this\n    }, React.createElement(\"thead\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114\n      },\n      __self: this\n    }, React.createElement(\"tr\", {\n      className: \"tableheader\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115\n      },\n      __self: this\n    }, React.createElement(\"th\", {\n      className: \"tablename\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }, \"\\u540D\\u524D\"), React.createElement(\"th\", {\n      className: \"tableday\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 117\n      },\n      __self: this\n    }, \"\\u65E5\\u6570\"), React.createElement(\"th\", {\n      className: \"tablecomment\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118\n      },\n      __self: this\n    }, \"\\u8FFD\\u8A18\"))), React.createElement(\"tbody\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121\n      },\n      __self: this\n    }, this.state.printcommentlist.map(comment => React.createElement(\"tr\", {\n      key: comment.name,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123\n      },\n      __self: this\n    }, React.createElement(\"td\", {\n      className: \"tablename\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124\n      },\n      __self: this\n    }, comment.name), React.createElement(\"td\", {\n      className: \"tableday\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125\n      },\n      __self: this\n    }, comment.wishday), React.createElement(\"td\", {\n      className: \"tablecommenttd\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 126\n      },\n      __self: this\n    }, comment.comment))))))) : React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133\n      },\n      __self: this\n    }, \"\\u30A2\\u30AF\\u30BB\\u30B9\\u3067\\u304D\\u307E\\u305B\\u3093\")));\n  } //初期\n\n\n  setdefaultDays() {\n    //表示する期間開始日を計算\n    const date = new Date();\n    const year = date.getFullYear();\n    const month = date.getMonth();\n    const day = date.getDate();\n    let startdate = \"\";\n\n    if (day < this.state.deadlineearly) {\n      startdate = new Date(year, month, 1);\n    } else if (day < this.state.deallinelate) {\n      startdate = new Date(year, month, 16);\n    } else if (day >= this.state.deallinelate) {\n      if (month === 11) {\n        startdate = new Date(year + 1, month + 1, 1);\n      } else {\n        startdate = new Date(year, month + 1, 1);\n      }\n    } //date確認用\n    //startdate = new Date(2019, 7, 16);\n\n\n    this.setprintDays(startdate);\n  } //表示期間前後ボタン\n\n\n  onClickchangeterm(e) {\n    const startdate = this.state.startdate;\n    let year = startdate.getFullYear();\n    let month = startdate.getMonth();\n    let day = startdate.getDate();\n    const str = e.target.value;\n\n    if (str === \"pre\") {\n      if (day === 16) {\n        day = 1;\n      } else if (day === 1) {\n        if (month === 0) {\n          year--;\n          month = 11;\n          day = 16;\n        } else {\n          month--;\n          day = 16;\n        }\n      }\n    } else if (str === \"back\") {\n      if (day === 1) {\n        day = 16;\n      } else if (day === 16) {\n        if (month === 11) {\n          year++;\n          month = 0;\n          day = 1;\n        } else {\n          month++;\n          day = 1;\n        }\n      }\n    }\n\n    const newstartdate = new Date(year, month, day);\n    this.setState({\n      startdate: newstartdate\n    });\n    this.setprintDays(newstartdate);\n    this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\n    this.sortmembercomment(this.state.memberlist, this.state.allcommentdata, newstartdate);\n  } //表示期間計算\n\n\n  setprintDays(startdate) {\n    //表示する期間配列生成\n    const days = [];\n\n    if (startdate.getDate() === 1) {\n      for (let i = 0; i < 15; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    } else if (startdate.getDate() === 16) {\n      const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\n\n      for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\n        days.push(startdate.getMonth() + 1 + \"/\" + (startdate.getDate() + i));\n      }\n    }\n\n    this.setState({\n      startdate: startdate,\n      printdays: days\n    });\n  } //表示用list作成（シフト\n\n\n  sortmembershift(members, shifts, startdate) {\n    const printdate = startdate;\n    let printfinaldate = \"\";\n    let shiftlist = [];\n\n    if (printdate.getDate() === 1) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15);\n      shiftlist = Array(15);\n    } else if (printdate.getDate() === 16) {\n      printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth() + 1, 0);\n      shiftlist = Array(printfinaldate.getDate() - 15);\n    }\n\n    const membertoshift = [];\n\n    for (const member of members) {\n      const myshift = shiftlist.slice();\n      myshift.fill(\"/\");\n\n      for (const shift of shifts) {\n        if (shift.userid === member.userid) {\n          const sd = String(shift.date);\n          const shiftyear = parseInt(sd.slice(0, 4));\n          const shiftmonth = parseInt(sd.slice(4, 6));\n          const shiftday = parseInt(sd.slice(6));\n\n          if (shiftyear === printdate.getFullYear() && shiftmonth === printdate.getMonth() + 1 && shiftday >= printdate.getDate() && shiftday <= printfinaldate.getDate()) {\n            //表示する情報\n            myshift[shiftday - printdate.getDate()] = shift.detail;\n          }\n        }\n      }\n\n      membertoshift.push({\n        name: member.name,\n        shift: myshift\n      });\n    }\n\n    this.setState({\n      printlist: membertoshift\n    });\n  } //表示用list作成（コメント\n\n\n  sortmembercomment(members, comments, startdate) {\n    const printdate = startdate;\n    const membertocomment = [];\n\n    for (const member of members) {\n      let isAdd = false;\n\n      for (const com of comments) {\n        if (member.userid === com.userid) {\n          const commentdate = new Date(com.date);\n\n          if (printdate.getFullYear() + \"/\" + printdate.getMonth() + \"/\" + printdate.getDate() === commentdate.getFullYear() + \"/\" + commentdate.getMonth() + \"/\" + commentdate.getDate()) {\n            membertocomment.push({\n              name: member.name,\n              wishday: com.wishday,\n              comment: com.text\n            });\n            isAdd = true;\n            break;\n          }\n        }\n      }\n\n      if (!isAdd) {\n        membertocomment.push({\n          name: member.name,\n          wishday: \"\",\n          comment: \"\"\n        });\n        isAdd = false;\n      }\n    }\n\n    this.setState({\n      printcommentlist: membertocomment\n    });\n  }\n\n}\n\nexport default Wishlist;","map":{"version":3,"sources":["C:\\Users\\03yuk\\Desktop\\private\\react\\shift-reserch3\\client\\src\\Wishlist.js"],"names":["React","Component","Wishlist","constructor","props","state","nowloading","accessable","memberlist","allshiftdata","allcommentdata","printlist","printcommentlist","deadlineearly","deallinelate","startdate","printdays","onClickchangeterm","bind","setprintDays","sortmembershift","sortmembercomment","componentDidMount","fetch","then","res","json","data","administer","setState","setdefaultDays","list","render","map","day","member","name","shift","comment","wishday","date","Date","year","getFullYear","month","getMonth","getDate","e","str","target","value","newstartdate","days","i","push","findate","members","shifts","printdate","printfinaldate","shiftlist","Array","membertoshift","myshift","slice","fill","userid","sd","String","shiftyear","parseInt","shiftmonth","shiftday","detail","comments","membertocomment","isAdd","com","commentdate","text"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\n\r\n\r\nclass Wishlist extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            //query: this.props.location.query,\r\n            nowloading: true,//読み込み中\r\n            accessable: false,//アクセス判定\r\n            memberlist: [],//登録メンバー\r\n            allshiftdata: [],//全シフト情報\r\n            allcommentdata: [],//全コメント情報\r\n            printlist: [],//表示するリスト\r\n            printcommentlist: [],//表示するコメントリスト\r\n            deadlineearly: 10,//締め切り日１\r\n            deallinelate: 24,//締め切り日２\r\n            startdate: \"\",\r\n            printdays: []//表示する期間\r\n        }\r\n\r\n        this.onClickchangeterm = this.onClickchangeterm.bind(this);\r\n        this.setprintDays = this.setprintDays.bind(this);\r\n        this.sortmembershift = this.sortmembershift.bind(this);\r\n        this.sortmembercomment = this.sortmembercomment.bind(this);\r\n    }\r\n    componentDidMount() {\r\n        //アクセス判定\r\n        //if (this.props.location.query !== undefined) {\r\n        //if (this.props.location.query.pass === \"administer\") {\r\n        //ユーザーデータ取得\r\n        //fetch('/testuserdata')\r\n        fetch('/userdata')\r\n            .then(res => res.json())\r\n            .then(data => {\r\n                if (data.administer) {\r\n                    //アクセス許可\r\n                    this.setState({\r\n                        accessable: true\r\n                    })\r\n                    this.setdefaultDays();\r\n                    //全ユーザー取得\r\n                    //fetch('/testmemberlist')\r\n                    fetch('/memberlist')\r\n                        .then(res => res.json())\r\n                        .then(list => {\r\n                            this.setState({ memberlist: list })\r\n                            //全シフト情報取得\r\n                            //fetch('/testallshiftdata')\r\n                            fetch('/allshiftdata')\r\n                                .then(res => res.json())\r\n                                .then(data => {\r\n                                    this.setState({ allshiftdata: data });\r\n                                    this.sortmembershift(list, data, this.state.startdate);\r\n                                })\r\n                            //全コメント取得\r\n                            //fetch('/testallcommentdata')\r\n                            fetch('/allcommentdata')\r\n                                .then(res => res.json())\r\n                                .then(data => {\r\n                                    this.setState({\r\n                                        allcommentdata: data,\r\n                                        nowloading: false\r\n                                    });\r\n                                    this.sortmembercomment(list, data, this.state.startdate);\r\n                                })\r\n                        })\r\n                } else {\r\n                    this.setState({ nowloading: false })\r\n                }\r\n            });\r\n\r\n\r\n        //}\r\n        //}\r\n    }\r\n    render() {\r\n        return (\r\n            <div>{this.state.nowloading ? (\r\n                <div>読み込み中</div>\r\n            ) : (\r\n                    <div>\r\n                        {this.state.accessable ? (\r\n                            <div>\r\n                                <h1>Wishlist</h1>\r\n                                シフト希望一覧\r\n                        <button className=\"bluebutton\" value=\"pre\" onClick={this.onClickchangeterm}>◁</button>\r\n                                <button className=\"bluebutton\" value=\"back\" onClick={this.onClickchangeterm}>▷</button>\r\n                                <div className=\"shittablediv\">\r\n                                    <table className=\"shifttable\">\r\n                                        <thead>\r\n                                            <tr>\r\n                                                <th className=\"blank\">名前</th>\r\n                                                {this.state.printdays.map((day) =>\r\n                                                    <th key={day}>{day}</th>\r\n                                                )}\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                            {this.state.printlist.map(member =>\r\n                                                <tr key={member.name}>\r\n                                                    <th key={member.name}>{member.name}</th>\r\n                                                    {member.shift.map(shift =>\r\n                                                        <td>{shift}</td>)}\r\n                                                </tr>\r\n                                            )}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                                <div className=\"wishtablediv\">\r\n\r\n                                    <h2>補足希望</h2>\r\n                                    <table className=\"wishtable\">\r\n                                        <thead>\r\n                                            <tr className=\"tableheader\">\r\n                                                <th className=\"tablename\">名前</th>\r\n                                                <th className=\"tableday\">日数</th>\r\n                                                <th className=\"tablecomment\">追記</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                            {this.state.printcommentlist.map(comment =>\r\n                                                <tr key={comment.name}>\r\n                                                    <td className=\"tablename\">{comment.name}</td>\r\n                                                    <td className=\"tableday\">{comment.wishday}</td>\r\n                                                    <td className=\"tablecommenttd\">{comment.comment}</td>\r\n                                                </tr>)}\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                                <div>アクセスできません</div>\r\n                            )}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        );\r\n    }\r\n    //初期\r\n    setdefaultDays() {\r\n        //表示する期間開始日を計算\r\n        const date = new Date();\r\n        const year = date.getFullYear();\r\n        const month = date.getMonth();\r\n        const day = date.getDate();\r\n        let startdate = \"\";\r\n        if (day < this.state.deadlineearly) {\r\n            startdate = new Date(year, month, 1);\r\n        } else if (day < this.state.deallinelate) {\r\n            startdate = new Date(year, month, 16);\r\n        } else if (day >= this.state.deallinelate) {\r\n            if (month === 11) {\r\n                startdate = new Date(year + 1, month + 1, 1);\r\n            } else {\r\n                startdate = new Date(year, month + 1, 1);\r\n            }\r\n        }\r\n        //date確認用\r\n        //startdate = new Date(2019, 7, 16);\r\n        this.setprintDays(startdate);\r\n    }\r\n    //表示期間前後ボタン\r\n    onClickchangeterm(e) {\r\n        const startdate = this.state.startdate;\r\n        let year = startdate.getFullYear();\r\n        let month = startdate.getMonth();\r\n        let day = startdate.getDate();\r\n        const str = e.target.value;\r\n\r\n        if (str === \"pre\") {\r\n            if (day === 16) {\r\n                day = 1;\r\n            } else if (day === 1) {\r\n                if (month === 0) {\r\n                    year--;\r\n                    month = 11;\r\n                    day = 16;\r\n                } else {\r\n                    month--;\r\n                    day = 16;\r\n                }\r\n            }\r\n        } else if (str === \"back\") {\r\n            if (day === 1) {\r\n                day = 16;\r\n            } else if (day === 16) {\r\n                if (month === 11) {\r\n                    year++;\r\n                    month = 0;\r\n                    day = 1;\r\n                } else {\r\n                    month++;\r\n                    day = 1;\r\n                }\r\n            }\r\n        }\r\n        const newstartdate = new Date(year, month, day);\r\n        this.setState({ startdate: newstartdate })\r\n        this.setprintDays(newstartdate);\r\n        this.sortmembershift(this.state.memberlist, this.state.allshiftdata, newstartdate);\r\n        this.sortmembercomment(this.state.memberlist, this.state.allcommentdata, newstartdate);\r\n    }\r\n    //表示期間計算\r\n    setprintDays(startdate) {\r\n        //表示する期間配列生成\r\n        const days = [];\r\n        if (startdate.getDate() === 1) {\r\n            for (let i = 0; i < 15; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        } else if (startdate.getDate() === 16) {\r\n            const findate = new Date(startdate.getFullYear(), startdate.getMonth() + 1, 0);\r\n            for (let i = 0; i < findate.getDate() - startdate.getDate() + 1; i++) {\r\n                days.push((startdate.getMonth() + 1) + \"/\" + (startdate.getDate() + i));\r\n            }\r\n        }\r\n        this.setState({\r\n            startdate: startdate,\r\n            printdays: days\r\n        });\r\n    }\r\n    //表示用list作成（シフト\r\n    sortmembershift(members, shifts, startdate) {\r\n        const printdate = startdate;\r\n        let printfinaldate = \"\";\r\n        let shiftlist = [];\r\n        if (printdate.getDate() === 1) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth(), 15)\r\n            shiftlist = Array(15);\r\n        } else if (printdate.getDate() === 16) {\r\n            printfinaldate = new Date(printdate.getFullYear(), printdate.getMonth() + 1, 0);\r\n            shiftlist = Array(printfinaldate.getDate() - 15);\r\n        }\r\n        const membertoshift = [];\r\n        for (const member of members) {\r\n            const myshift = shiftlist.slice();\r\n            myshift.fill(\"/\");\r\n            for (const shift of shifts) {\r\n                if (shift.userid === member.userid) {\r\n                    const sd = String(shift.date);\r\n                    const shiftyear = parseInt(sd.slice(0, 4));\r\n                    const shiftmonth = parseInt(sd.slice(4, 6));\r\n                    const shiftday = parseInt(sd.slice(6));\r\n                    if ((shiftyear === printdate.getFullYear()) &&\r\n                        (shiftmonth === (printdate.getMonth() + 1)) &&\r\n                        (shiftday >= printdate.getDate()) &&\r\n                        (shiftday <= printfinaldate.getDate())) {\r\n                        //表示する情報\r\n                        myshift[shiftday - printdate.getDate()] = shift.detail;\r\n                    }\r\n                }\r\n            }\r\n            membertoshift.push({\r\n                name: member.name,\r\n                shift: myshift\r\n            })\r\n        }\r\n\r\n        this.setState({\r\n            printlist: membertoshift\r\n        });\r\n    }\r\n    //表示用list作成（コメント\r\n    sortmembercomment(members, comments, startdate) {\r\n        const printdate = startdate;\r\n        const membertocomment = [];\r\n        for (const member of members) {\r\n            let isAdd = false;\r\n            for (const com of comments) {\r\n                if (member.userid === com.userid) {\r\n                    const commentdate = new Date(com.date);\r\n                    if ((printdate.getFullYear() + \"/\" + printdate.getMonth() + \"/\" + printdate.getDate()) ===\r\n                        commentdate.getFullYear() + \"/\" + commentdate.getMonth() + \"/\" + commentdate.getDate()) {\r\n                        membertocomment.push({\r\n                            name: member.name,\r\n                            wishday: com.wishday,\r\n                            comment: com.text\r\n                        })\r\n                        isAdd = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            if (!isAdd) {\r\n                membertocomment.push({\r\n                    name: member.name,\r\n                    wishday: \"\",\r\n                    comment: \"\"\r\n                })\r\n                isAdd = false;\r\n            }\r\n        }\r\n        this.setState({\r\n            printcommentlist: membertocomment\r\n        });\r\n    }\r\n}\r\n\r\nexport default Wishlist;"]},"metadata":{},"sourceType":"module"}